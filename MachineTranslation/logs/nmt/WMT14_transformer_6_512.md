## 1.基本参数

### 1.1 数据集参数
    
    WMT-14-English-Germa 数据集
    (预处理后的 数据集地址 https://nlp.stanford.edu/projects/nmt/ )
    
### 1.2 模型参数

配置文件: config/transformer_seq2seq.ini (tag='DEFAULT') 
          
    # 源句子的最大编码位置
    maximum_position_source = 1000
    
    # 目标句子的最大编码位置
    maximum_position_target = 1000
    
    # 堆叠的编码器(解码器)的层数
    num_layers = 6
    
    # 模型整体的隐藏层的维度
    d_model = 512
    
    #并行注意力层的个数(头数)
    num_heads = 8
    
    #Position-wise Feed-Forward 的中间层的维度
    dff = 2048

## 2.实验记录

### 2.1 验证 不同划分 batch 策略的效果

#### 实验 1  动态 batch size
    
    (0) 模型
       
    (1) 数据集 
    
    训练数据:    
    N_train = 4343134 ( 源句子-目标句子 pair 的数目, 过滤掉长度大于 64 )
    
    most common seq length: (seq length, count num)
    [(17, 155827), (16, 155629), (15, 154656), (18, 153586), (19, 151796), (14, 149838), (20, 147657), (13, 143601), (21, 143144), (22, 139581)]
    seq length count:  (seq length, count num)
    [(100, 572), (99, 616), (98, 645), (97, 711), (96, 782), (95, 829), (94, 859), (93, 1004), (92, 1022), (91, 1117), (90, 1271), (89, 1305), (88, 1543), (87, 1572), (86, 1629), (85, 1698), (84, 1904), (83, 1976), (82, 2154), (81, 2365), (80, 2506), (79, 2846), (78, 3033), (77, 3184), (76, 3518), (75, 3630), (74, 4014), (73, 4170), (72, 4749), (71, 5061), (70, 5388), (69, 5590), (68, 6176), (67, 6689), (66, 7217), (65, 7744), (64, 8343), (63, 9033), (62, 9905), (61, 10646), (60, 11308), (59, 12336), (58, 13193), (57, 14414), (56, 15450), (55, 16969), (54, 18876), (53, 20326), (52, 20903), (51, 22590), (50, 24098), (49, 25983), (48, 28325), (47, 30461), (46, 32027), (45, 35146), (44, 37382), (43, 40306), (42, 43267), (41, 46180), (40, 50308), (39, 53441), (38, 57900), (37, 62886), (36, 66840), (35, 71266), (34, 76766), (33, 81583), (32, 87484), (31, 92126), (30, 97864), (29, 102435), (28, 107874), (27, 113869), (26, 119401), (25, 124660), (24, 130374), (23, 135714), (22, 139581), (21, 143144), (20, 147657), (19, 151796), (18, 153586), (17, 155827), (16, 155629), (15, 154656), (14, 149838), (13, 143601), (12, 138078), (11, 128739), (10, 114370), (9, 102814), (8, 79692), (7, 59132), (6, 26251), (5, 19701), (4, 8034), (3, 6680), (2, 2357), (1, 6330)]
    target sentence length distribution:
    most common seq length: (seq length, count num)
    [(16, 165532), (15, 164658), (14, 162805), (17, 162654), (18, 159080), (13, 156485), (19, 155026), (20, 152030), (12, 150160), (21, 146299)]
    seq length count:  (seq length, count num)
    [(100, 296), (99, 305), (98, 337), (97, 404), (96, 408), (95, 505), (94, 531), (93, 592), (92, 625), (91, 679), (90, 780), (89, 823), (88, 946), (87, 1030), (86, 1043), (85, 1231), (84, 1310), (83, 1419), (82, 1578), (81, 1669), (80, 1809), (79, 2021), (78, 2093), (77, 2262), (76, 2526), (75, 2686), (74, 2929), (73, 3126), (72, 3490), (71, 3657), (70, 4098), (69, 4449), (68, 4756), (67, 5061), (66, 5529), (65, 6028), (64, 6545), (63, 7198), (62, 7723), (61, 8621), (60, 9866), (59, 10771), (58, 11773), (57, 11776), (56, 12672), (55, 13951), (54, 15069), (53, 15959), (52, 17481), (51, 18943), (50, 20747), (49, 22558), (48, 24116), (47, 26549), (46, 28347), (45, 30953), (44, 33673), (43, 35959), (42, 38732), (41, 41909), (40, 46090), (39, 49991), (38, 53894), (37, 56454), (36, 60835), (35, 65440), (34, 70125), (33, 75182), (32, 81015), (31, 86883), (30, 91586), (29, 98251), (28, 104117), (27, 111076), (26, 118207), (25, 123028), (24, 128857), (23, 134906), (22, 140894), (21, 146299), (20, 152030), (19, 155026), (18, 159080), (17, 162654), (16, 165532), (15, 164658), (14, 162805), (13, 156485), (12, 150160), (11, 142053), (10, 134701), (9, 123547), (8, 97630), (7, 74183), (6, 33878), (5, 21733), (4, 8039), (3, 9064), (2, 2468), (1, 5062)]
    seq length <=64 num: 4343134
    
    验证数据: 
    N_valid = 2975 ( 源句子-目标句子 pair 的数目, 过滤掉长度大于 64 ) 
    
    most common seq length: (seq length, count num)
    [(20, 121), (13, 120), (14, 115), (15, 115), (16, 115), (11, 108), (19, 106), (21, 103), (18, 103), (17, 103)]
    seq length count:  (seq length, count num)
    [(106, 1), (92, 1), (91, 1), (90, 1), (88, 1), (86, 1), (80, 2), (79, 1), (78, 1), (76, 1), (75, 1), (74, 2), (72, 1), (70, 2), (68, 1), (66, 2), (64, 3), (63, 4), (62, 6), (61, 2), (60, 4), (59, 5), (58, 4), (57, 3), (56, 3), (55, 6), (54, 9), (53, 13), (52, 8), (51, 12), (50, 10), (49, 14), (48, 17), (47, 10), (46, 14), (45, 15), (44, 10), (43, 16), (42, 13), (41, 19), (40, 33), (39, 22), (38, 24), (37, 27), (36, 40), (35, 34), (34, 45), (33, 61), (32, 45), (31, 49), (30, 53), (29, 65), (28, 58), (27, 69), (26, 79), (25, 73), (24, 81), (23, 88), (22, 98), (21, 103), (20, 121), (19, 106), (18, 103), (17, 103), (16, 115), (15, 115), (14, 115), (13, 120), (12, 96), (11, 108), (10, 98), (9, 89), (8, 89), (7, 68), (6, 67), (5, 37), (4, 24), (3, 14), (2, 18), (1, 7)]
    target sentence length distribution:
    most common seq length: (seq length, count num)
    [(13, 129), (15, 122), (16, 117), (11, 115), (12, 111), (20, 108), (14, 107), (10, 106), (19, 105), (18, 104)]
    seq length count:  (seq length, count num)
    [(103, 1), (98, 1), (95, 2), (92, 1), (87, 1), (85, 1), (84, 1), (83, 1), (81, 1), (80, 1), (79, 1), (77, 1), (74, 1), (72, 1), (71, 1), (69, 3), (67, 2), (66, 2), (64, 2), (63, 5), (62, 3), (61, 3), (60, 3), (59, 3), (58, 4), (57, 8), (56, 3), (55, 4), (54, 5), (53, 7), (52, 7), (51, 13), (50, 4), (49, 7), (48, 9), (47, 9), (46, 16), (45, 20), (44, 12), (43, 16), (42, 21), (41, 26), (40, 30), (39, 30), (38, 25), (37, 29), (36, 32), (35, 38), (34, 34), (33, 53), (32, 37), (31, 54), (30, 62), (29, 61), (28, 77), (27, 67), (26, 62), (25, 64), (24, 94), (23, 78), (22, 80), (21, 89), (20, 108), (19, 105), (18, 104), (17, 97), (16, 117), (15, 122), (14, 107), (13, 129), (12, 111), (11, 115), (10, 106), (9, 93), (8, 80), (7, 95), (6, 64), (5, 54), (4, 21), (3, 19), (2, 17), (1, 7)]
    seq length <=64 num: 2975

    测试数据: 
    N_test = 2737 
    
    most common seq length: (seq length, count num)
    [(13, 113), (14, 112), (18, 112), (16, 101), (17, 100), (15, 100), (20, 95), (19, 94), (23, 94), (21, 92)]
    seq length count:  (seq length, count num)
    [(91, 1), (83, 1), (79, 1), (72, 2), (69, 1), (68, 2), (64, 2), (63, 2), (62, 1), (61, 2), (59, 2), (58, 9), (57, 2), (56, 4), (55, 7), (54, 2), (53, 4), (52, 7), (51, 11), (50, 14), (49, 8), (48, 12), (47, 14), (46, 15), (45, 15), (44, 26), (43, 29), (42, 21), (41, 14), (40, 29), (39, 33), (38, 35), (37, 35), (36, 44), (35, 41), (34, 46), (33, 47), (32, 53), (31, 66), (30, 63), (29, 59), (28, 73), (27, 77), (26, 58), (25, 85), (24, 86), (23, 94), (22, 92), (21, 92), (20, 95), (19, 94), (18, 112), (17, 100), (16, 101), (15, 100), (14, 112), (13, 113), (12, 82), (11, 81), (10, 73), (9, 69), (8, 52), (7, 50), (6, 36), (5, 15), (4, 7), (3, 4), (2, 2)]
    target sentence length distribution:
    most common seq length: (seq length, count num)
    [(19, 125), (14, 119), (15, 118), (13, 105), (17, 105), (12, 103), (10, 101), (16, 100), (20, 98), (21, 96)]
    seq length count:  (seq length, count num)
    [(75, 1), (72, 2), (70, 1), (68, 1), (64, 1), (63, 2), (60, 3), (59, 3), (58, 1), (57, 3), (56, 5), (55, 3), (54, 2), (53, 9), (52, 7), (51, 2), (50, 8), (49, 7), (48, 12), (47, 11), (46, 14), (45, 20), (44, 15), (43, 17), (42, 25), (41, 19), (40, 28), (39, 23), (38, 19), (37, 27), (36, 32), (35, 43), (34, 37), (33, 41), (32, 58), (31, 48), (30, 67), (29, 56), (28, 66), (27, 63), (26, 71), (25, 71), (24, 64), (23, 89), (22, 84), (21, 96), (20, 98), (19, 125), (18, 79), (17, 105), (16, 100), (15, 118), (14, 119), (13, 105), (12, 103), (11, 92), (10, 101), (9, 87), (8, 60), (7, 73), (6, 46), (5, 28), (4, 14), (3, 6), (2, 1)]
    seq length <=100 num: 2737
    
    (2) 数据预处理
    
    未做 unicode 标准化
    
    使用 wordpiece subword 算法分词
    源语言词表大小: n_vocab_source=30000
    目标语言词表大小: n_vocab_target=30000
    
    
    (3) 优化器参数
    
    epoch_num = 20
    token_in_batch = 12288
    
    optimizer= Adam with warmup_steps
    warmup_steps = 32000
    
    (5) 训练过程
    
    在每一个 epoch 结束时都对模型进行持久化(checkpoint), 并计算在验证集上的 bleu 得分
    
    
        
    (6) 模型评价
    
    1.epoch=18 时的模型
    
    
        
    