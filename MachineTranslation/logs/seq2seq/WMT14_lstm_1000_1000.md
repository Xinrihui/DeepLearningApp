## 1.基本参数

### 1.1 数据集参数
    
    WMT14 English-Germa 数据集 
    
    (数据集中的句子挑选 https://nlp.stanford.edu/projects/nmt/ )

### 1.2 模型参数
    
    基于词粒度(word level)
    
    词向量维度 n_embedding = 1000
    
    隐藏层的维度 n_h = 1000

## 2.实验记录


### 2.1 验证 unicode 标准化 的效果

#### 实验 1 unicode 标准化(NKFD)

    (1) 数据集 
    
    训练数据:   
    N_train = 4.5 million ( 源句子-目标句子对 的数目)
    
    验证数据: newstest2013
    N_valid = 3000
    
    测试数据: newstest2014
    N_test = 2737
    
    (2) 数据预处理
    
    对英语和德语都做 unicode 标准化(NKFD), 并进行小写化 
    
    删除语料库中单独出现的数字, 符号( 保留 ' 和 - ), 和特殊的无意义单词: ##AT##-##AT## , &apos , &quot, „
    
    源语言词表大小: n_vocab_source=50k
    目标语言词表大小: n_vocab_target=50k
    
    源句子的长度: max_source_length = 50
    目标句子的长度: max_target_length = 50
    
    将源句子反向输入模型
    
    (3) 优化器参数
    
    epoch_num = 10
    batch_size = 256
    optimizer='rmsprop'
    
    
    (4) 训练过程
    
    在每一个 epoch 结束时都对模型进行持久化(checkpoint), 并计算在验证集上的 bleu 得分
    
        
    (6) 模型评价
    
    1.epoch=6 时的模型
    
    candidates:
    orlando [UNK] und noch immer [UNK] sich gegenseitig [UNK] liebe [END]                                      
    die akteure der länder und der nationen – wie sich die [UNK] – wollen ihre eigenen wege [UNK] [END]                              
    in einem interview jedoch sagte er dass „ [UNK] und „ [UNK] einander [UNK] [END]                                  
    die [UNK] und [UNK] [UNK] sind die eltern auf zwei jahre alt [END]                                    
    der legendäre schauspieler twitter seine frau von seiner [UNK] [UNK] [UNK] [END]                                     
    in einem interview mit dem amerikanischen [UNK] [UNK] [UNK] der gerade am freitag dem september [UNK] wird die [UNK] manchmal genau wie gesagt das leben soll nicht [UNK] [END]                    
    er und [UNK] lieben das land noch immer [UNK] [END]                                       
    wir werden einander unterstützen und einander in bezug auf die familie nach einer anderen [UNK] [END]                                 
    seit verheiratet und [UNK] sind verheiratet und sohn verheiratet [END]                                       
    [UNK] [UNK] sind mit großen herausforderungen auf dem spiel stehen die [UNK] [END]                                    
    
    references:
    ['[START] orlando bloom und miranda kerr lieben sich noch immer [END]']
    ['[START] schauspieler orlando bloom und model miranda kerr wollen künftig getrennte wege gehen [END]']
    ['[START] in einem interview sagte bloom jedoch   dass er und kerr sich noch immer lieben [END]']
    ['[START] miranda kerr und orlando bloom sind eltern des zweijährigen flynn [END]']
    ['[START] schauspieler orlando bloom hat sich zur trennung von seiner frau   topmodel miranda kerr   geäußert [END]']
    ['[START] in einem interview mit us  journalistin katie couric   das am freitag   ortszeit   ausgestrahlt werden sollte   sagte bloom     das leben verläuft manchmal nicht genau so   wie wir es planen oder erhoffen [END]']
    ['[START] kerr und er selbst liebten sich noch immer   betonte der  jährige [END]']
    ['[START] wir werden uns gegenseitig unterstützen und lieben als eltern von flynn [END]']
    ['[START] kerr und bloom sind seit verheiratet   im jahr wurde ihr söhnchen flynn geboren [END]']
    ['[START] jumbo  hersteller streiten im angesicht großer bestellungen über sitzbreite [END]']


#### 实验 2 unicode 标准化(NKFC)


    (1) 数据集 
    
    训练数据:   
    N_train = 4.5 million ( 源句子-目标句子对 的数目)
    
    验证数据: newstest2013
    N_valid = 3000
    
    测试数据: newstest2014
    N_test = 2737
    
    (2) 数据预处理
    
    对英语和德语都做 unicode 标准化(NKFC), 并进行小写化 
    
    删除语料库中单独出现的数字, 符号( 保留 ' 和 - ), 和特殊的无意义单词: ##AT##-##AT## , &apos , &quot, „
    
    源语言词表大小: n_vocab_source=50k
    目标语言词表大小: n_vocab_target=50k
    
    源句子的长度: max_source_length = 50
    目标句子的长度: max_target_length = 50
    
    将源句子反向输入模型
    
    (3) 优化器参数
    
    epoch_num = 10
    batch_size = 256
    optimizer='rmsprop'
    
    
    (4) 训练过程
    
    在每一个 epoch 结束时都对模型进行持久化(checkpoint), 并计算在验证集上的 bleu 得分
    
        
    (6) 模型评价
    
    1.epoch=8 时的模型
    
    保留所有的 [UNK] 进行评价
    
    candidates:
    die sich der [UNK] und der liebe stellen sich gegenseitig immer noch von liebe [END]                                  
    die [UNK] von aktien und teilen des modells gehen wollen ihre eigenen arten von extremisten [END]                                 
    in einem interview sagte er jedoch dass sich die [UNK] und die liebe zwischen ihnen und immer noch gegenseitig [UNK] [END]                            
    die von mir und von eltern [UNK] sind in der zwei jahre alt und sind in der tat die [UNK] [END]                            
    der südkoreanischen [UNK] seine frau seine [UNK] von der [UNK] von kim jong ils [END]                                  
    in einem interview mit dem uns das [UNK] [UNK] [UNK] [UNK] [UNK] [UNK] [UNK] [UNK] sagte wird uns das leben manchmal nicht so eng wie geplant oder finanziert [END]                    
    er und die asiaten die liebe das jahr noch immer die liebe die andere [END]                                  
    wir werden einander gegenseitig unterstützen und lieben wir uns gegenseitig als eltern [END]                                    
    verheiratet und sind seit verheiratet sohn und geboren wurde ihr kind geboren [END]                                    
    [UNK] sind die [UNK] auf der hand und das große spiel mit dem wunsch nach einer [UNK] [END]                               
    
    references:
    ['[START] orlando bloom und miranda kerr lieben sich noch immer [END]']
    ['[START] schauspieler orlando bloom und model miranda kerr wollen künftig getrennte wege gehen [END]']
    ['[START] in einem interview sagte bloom jedoch   dass er und kerr sich noch immer lieben [END]']
    ['[START] miranda kerr und orlando bloom sind eltern des zweijährigen flynn [END]']
    ['[START] schauspieler orlando bloom hat sich zur trennung von seiner frau   topmodel miranda kerr   geäußert [END]']
    ['[START] in einem interview mit us  journalistin katie couric   das am freitag   ortszeit   ausgestrahlt werden sollte   sagte bloom     das leben verläuft manchmal nicht genau so   wie wir es planen oder erhoffen [END]']
    ['[START] kerr und er selbst liebten sich noch immer   betonte der  jährige [END]']
    ['[START] wir werden uns gegenseitig unterstützen und lieben als eltern von flynn [END]']
    ['[START] kerr und bloom sind seit verheiratet   im jahr wurde ihr söhnchen flynn geboren [END]']
    ['[START] jumbo  hersteller streiten im angesicht großer bestellungen über sitzbreite [END]']
    
    

### 2.2 验证 多层堆叠 LSTM 的效果

#### 实验 3 单层 LSTM 
    
    (0) 模型
       
       编码器和解码器均为单层 LSTM, 解码器的 LSTM 和 输出层 中间使用 Dropout(0.5) 连接, dropout 正则化 dropout_rates = (0.2,)
    
    (1) 数据集 
    
    训练数据:   
    N_train = 4094299 ( 源句子-目标句子对 的数目, 过滤掉长度大于 50)
    
    source sentence length distribution:
    most common seq length: (seq length, count num)
    [(17, 155827), (16, 155629), (15, 154656), (18, 153586), (19, 151796), (14, 149838), (20, 147657), (13, 143601), (21, 143144), (22, 139581)]
    seq length count:  (seq length, count num)
    [(100, 572), (99, 616), (98, 645), (97, 711), (96, 782), (95, 829), (94, 859), (93, 1004), (92, 1022), (91, 1117), (90, 1271), (89, 1305), (88, 1543), (87, 1572), (86, 1629), (85, 1698), (84, 1904), (83, 1976), (82, 2154), (81, 2365), (80, 2506), (79, 2846), (78, 3033), (77, 3184), (76, 3518), (75, 3630), (74, 4014), (73, 4170), (72, 4749), (71, 5061), (70, 5388), (69, 5590), (68, 6176), (67, 6689), (66, 7217), (65, 7744), (64, 8343), (63, 9033), (62, 9905), (61, 10646), (60, 11308), (59, 12336), (58, 13193), (57, 14414), (56, 15450), (55, 16969), (54, 18876), (53, 20326), (52, 20903), (51, 22590), (50, 24098), (49, 25983), (48, 28325), (47, 30461), (46, 32027), (45, 35146), (44, 37382), (43, 40306), (42, 43267), (41, 46180), (40, 50308), (39, 53441), (38, 57900), (37, 62886), (36, 66840), (35, 71266), (34, 76766), (33, 81583), (32, 87484), (31, 92126), (30, 97864), (29, 102435), (28, 107874), (27, 113869), (26, 119401), (25, 124660), (24, 130374), (23, 135714), (22, 139581), (21, 143144), (20, 147657), (19, 151796), (18, 153586), (17, 155827), (16, 155629), (15, 154656), (14, 149838), (13, 143601), (12, 138078), (11, 128739), (10, 114370), (9, 102814), (8, 79692), (7, 59132), (6, 26251), (5, 19701), (4, 8034), (3, 6680), (2, 2357), (1, 6330)]
    
    target sentence length distribution:
    most common seq length: (seq length, count num)
    [(16, 165532), (15, 164658), (14, 162805), (17, 162654), (18, 159080), (13, 156485), (19, 155026), (20, 152030), (12, 150160), (21, 146299)]
    seq length count:  (seq length, count num)
    [(100, 296), (99, 305), (98, 337), (97, 404), (96, 408), (95, 505), (94, 531), (93, 592), (92, 625), (91, 679), (90, 780), (89, 823), (88, 946), (87, 1030), (86, 1043), (85, 1231), (84, 1310), (83, 1419), (82, 1578), (81, 1669), (80, 1809), (79, 2021), (78, 2093), (77, 2262), (76, 2526), (75, 2686), (74, 2929), (73, 3126), (72, 3490), (71, 3657), (70, 4098), (69, 4449), (68, 4756), (67, 5061), (66, 5529), (65, 6028), (64, 6545), (63, 7198), (62, 7723), (61, 8621), (60, 9866), (59, 10771), (58, 11773), (57, 11776), (56, 12672), (55, 13951), (54, 15069), (53, 15959), (52, 17481), (51, 18943), (50, 20747), (49, 22558), (48, 24116), (47, 26549), (46, 28347), (45, 30953), (44, 33673), (43, 35959), (42, 38732), (41, 41909), (40, 46090), (39, 49991), (38, 53894), (37, 56454), (36, 60835), (35, 65440), (34, 70125), (33, 75182), (32, 81015), (31, 86883), (30, 91586), (29, 98251), (28, 104117), (27, 111076), (26, 118207), (25, 123028), (24, 128857), (23, 134906), (22, 140894), (21, 146299), (20, 152030), (19, 155026), (18, 159080), (17, 162654), (16, 165532), (15, 164658), (14, 162805), (13, 156485), (12, 150160), (11, 142053), (10, 134701), (9, 123547), (8, 97630), (7, 74183), (6, 33878), (5, 21733), (4, 8039), (3, 9064), (2, 2468), (1, 5062)]
    
    seq length <=50 num: 4094299
    
    验证数据: newstest2013 
    N_valid = 2883  (过滤掉长度大于 50)
    
    测试数据: newstest2014
    N_test = 2737 
    
    (2) 数据预处理
    
    对英语和德语都做 unicode 标准化(NKFC), 并进行大小写折叠(case fold)
    
    删除语料库中不在拉丁语系中的单词, 单独出现的数字, 符号( 保留 ' 和 - ), 和特殊的无意义单词: ##AT##-##AT## , &apos , &quot,
    
    源语言词表大小: n_vocab_source=50k
    目标语言词表大小: n_vocab_target=50k
    
    对于训练数据和验证数据, 将句子向量化为固定的长度
    源句子向量化后的长度: max_seq_length = 50
    目标句子向量化后的长度: max_seq_length = 50
    
    将源句子反向输入模型
    
    (3) 优化器参数
    
    epoch_num = 10
    batch_size = 256
    optimizer='rmsprop'
    
    
    (5) 训练过程
    
    在每一个 epoch 结束时都对模型进行持久化(checkpoint), 并计算在验证集上的 bleu 得分
    
    Epoch 1/10
    bleu_score:{'1-garm': 0.26906431123853325, '2-garm': 0.13892282776175313, '3-garm': 0.07750465817155257, '4-garm': 0.04502927217545498}
    15994/15994 [==============================] - 4177s 261ms/step - loss: 1.7699 - accuracy: 0.7322 - val_loss: 1.5427 - val_accuracy: 0.7691
    
    Epoch 2/10
    bleu_score:{'1-garm': 0.28767879752889564, '2-garm': 0.15318258926037973, '3-garm': 0.0872974024872314, '4-garm': 0.05174735788535346}
    15994/15994 [==============================] - 4213s 263ms/step - loss: 1.6417 - accuracy: 0.7497 - val_loss: 1.5186 - val_accuracy: 0.7745
    
    Epoch 3/10
    bleu_score:{'1-garm': 0.29327253561534095, '2-garm': 0.1585406957637988, '3-garm': 0.09154815258911893, '4-garm': 0.05465899343131736}
    15994/15994 [==============================] - 4206s 263ms/step - loss: 1.6287 - accuracy: 0.7533 - val_loss: 1.5134 - val_accuracy: 0.7764
    
    Epoch 4/10
    bleu_score:{'1-garm': 0.3037168617589985, '2-garm': 0.16600837433151827, '3-garm': 0.09747612465811514, '4-garm': 0.059048954203868735}
    15994/15994 [==============================] - 4232s 264ms/step - loss: 1.6168 - accuracy: 0.7552 - val_loss: 1.5102 - val_accuracy: 0.7788
    
    Epoch 5/10
    bleu_score:{'1-garm': 0.3065308686010539, '2-garm': 0.16739763314001765, '3-garm': 0.09773008500932075, '4-garm': 0.05905037184741836}
    15994/15994 [==============================] - 4230s 264ms/step - loss: 1.6036 - accuracy: 0.7559 - val_loss: 1.5005 - val_accuracy: 0.7781
    
    Epoch 6/10
    bleu_score:{'1-garm': 0.30456168027873015, '2-garm': 0.16686701810797228, '3-garm': 0.09811753364093108, '4-garm': 0.06000295699560698}
    15994/15994 [==============================] - 4191s 262ms/step - loss: 1.6003 - accuracy: 0.7564 - val_loss: 1.4986 - val_accuracy: 0.7788
    
    Epoch 7/10
    bleu_score:{'1-garm': 0.31459447407842933, '2-garm': 0.17150909764536945, '3-garm': 0.1011506926773095, '4-garm': 0.06121008146521982}
    15994/15994 [==============================] - 4177s 261ms/step - loss: 1.5901 - accuracy: 0.7570 - val_loss: 1.4922 - val_accuracy: 0.7792
    
    Epoch 8/10
    bleu_score:{'1-garm': 0.3025677391608834, '2-garm': 0.1680371744934818, '3-garm': 0.10001539903710409, '4-garm': 0.060889438998815465}
    15994/15994 [==============================] - 4180s 261ms/step - loss: 1.5781 - accuracy: 0.7575 - val_loss: 1.4919 - val_accuracy: 0.7781
    
    Epoch 9/10
    bleu_score:{'1-garm': 0.31067212184425474, '2-garm': 0.16976806710631545, '3-garm': 0.09906530592113495, '4-garm': 0.05991219079175276}
    15994/15994 [==============================] - 4212s 263ms/step - loss: 1.5704 - accuracy: 0.7575 - val_loss: 1.4955 - val_accuracy: 0.7785
    
    Epoch 10/10
    bleu_score:{'1-garm': 0.30286884248296114, '2-garm': 0.1664034218930476, '3-garm': 0.09851564837247777, '4-garm': 0.06057840910264559}
    15994/15994 [==============================] - 4236s 264ms/step - loss: 1.5645 - accuracy: 0.7580 - val_loss: 1.4897 - val_accuracy: 0.7786
    
    final learning_rate: 0.001

        
    (6) 模型评价
    
    1.epoch=7 时的模型
    
    保留所有的 [UNK] 进行评价
    
    candidates:
    [0] orlando die [UNK] und die [UNK] frau miranda sind immer noch [UNK] [END]
    [1] [UNK] demokratien und andere [UNK] [UNK] ihre [UNK] wollen sich verschiedene formen der [UNK] entwickeln [END]
    [2] in einem interview sagte er allerdings noch die [UNK] und die liebe [END]
    [3] in [UNK] [UNK] und [UNK] sind herrn flynn zu einem alten [UNK] [END]
    [4] die [UNK] [UNK] von frau [UNK] [UNK] [UNK] [UNK] [UNK] [UNK] [END]
    [5] in einem interview mit dem [UNK] [UNK] der [UNK] [UNK] der [UNK] [UNK] wird das [UNK] [UNK] [UNK] und wir hoffen nicht nur [UNK] sondern auch [UNK] [END]
    [6] er und das frau noch einmal liebe das jahr das [UNK] [END]
    [7] wir werden uns gegenseitig unterstützen und die eltern in [UNK] zu unterstützen [END]
    [8] die [UNK] und die [UNK] [UNK] sind seit ihrer [UNK] im leben [END]
    [9] [UNK] [UNK] [UNK] mit [UNK] [UNK] [END]
    
    references:
    [0] ['[START] orlando bloom und miranda kerr lieben sich noch immer [END]']
    [1] ['[START] schauspieler orlando bloom und model miranda kerr wollen künftig getrennte wege gehen [END]']
    [2] ['[START] in einem interview sagte bloom jedoch   dass er und kerr sich noch immer lieben [END]']
    [3] ['[START] miranda kerr und orlando bloom sind eltern des zweijährigen flynn [END]']
    [4] ['[START] schauspieler orlando bloom hat sich zur trennung von seiner frau   topmodel miranda kerr   geäussert [END]']
    [5] ['[START] in einem interview mit us  journalistin katie couric   das am freitag   ortszeit   ausgestrahlt werden sollte   sagte bloom     das leben verläuft manchmal nicht genau so   wie wir es planen oder erhoffen [END]']
    [6] ['[START] kerr und er selbst liebten sich noch immer   betonte der jährige [END]']
    [7] ['[START] wir werden uns gegenseitig unterstützen und lieben als eltern von flynn [END]']
    [8] ['[START] kerr und bloom sind seitverheiratet   im jahrwurde ihr söhnchen flynn geboren [END]']
    [9] ['[START] jumbo  hersteller streiten im angesicht grosser bestellungen über sitzbreite [END]']
    
    bleu_score:{'1-garm': 0.26551940908376553, '2-garm': 0.13258414151053394, '3-garm': 0.07172948916267198, '4-garm': 0.040995593917398473}

    
    
        
    